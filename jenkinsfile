pipeline {
    agent any
     environment {
        projectName = "test-project"
    }

    stages {
        stage('Checkout source code') {
            steps{
                bat "echo running "
        }
     }
        stage('Build') {
            steps {
                // nodejs(nodeJSInstallationName: 'Node') {
                //     bat 'npm install -g node-gyp'
                //     bat 'npm i'
                //     bat 'npm run start'
                // }
                bat 'npm i'

            }
            
        }
        // stage('Test') {
        //     steps {
        //         bat 'npm run start'
        //     } 
        // }        

        
            stage ("SonarQube Scan") {
                steps {
                    withEnv(["PATH=C:/Users/I526042/Downloads/sonarqube-developer-9.7.1.62043/sonarqube-9.7.1.62043/bin"]) {
                        withSonarQubeEnv('sonar-assignement') { 
                        bat "sonar-scanner \
                            -Dsonar.projectKey=${projectName} \
                            -Dsonar.sources=. \
                            -Dsonar.host.url=${env.SONAR_HOST_URL} \
                            -Dsonar.login=${env.SONAR_AUTH_TOKEN} \
                            -Dsonar.projectName=${projectName} \
                            -Dsonar.projectVersion=${env.BUILD_ID}"
                    }
                 }
            }
        }
    }
}
